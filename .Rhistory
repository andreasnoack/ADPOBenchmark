device="jpeg",
width=3.3,
height=4)
NLME_NoHessian_data <- read.csv("NLMEResults_NoHessian.csv")
View(NLME_NoHessian_data)
a
a
a
a
a
a
a
a
a
a
# calculate status 7 if crash/didn't complete, 1 is success, 4 if errors
NONMEM_data <- NONMEM_data %>%
mutate(Status = if_else(messages == 37,1,4))  %>%
mutate(Status = if_else(messages == -99999,7,Status))  %>%
relocate(Status, .after = Success)
NONMEM_data_filtered <- NONMEM_data %>%
filter(Status < 7)
NLME_standard_data <- read.csv("NLMEResults_Standard.csv")
# fix algorithm name
NLME_standard_data$Algorithm <- "Standard"
NLME_standard_data_filtered <- NLME_standard_data
NLME_ADPO_data <- read.csv("NLMEResults_ADPO.csv")
# only adpo data at this point has status, for plots filter out status == 7
NLME_ADPO_data_filtered <- NLME_ADPO_data %>%
dplyr::filter(Status < 5)
NLME_NoHessian_data <- read.csv("NLMEResults_NoHessian.csv")
NLME_NoHessian_data_filtered <- NLME_NoHessian_data # none crashed
NLME_NoCache_data <- read.csv("NLMEResults_NoCache.csv")
# fix name
NLME_NoCache_data$Algorithm <- "NoCache"
# need to rereun no cache to get status
NLME_NoCache_data <- NLME_NoCache_data %>%
mutate(Status = messages)  %>%
relocate(Status, .after = Success)
NLME_NoCache_data <- NLME_NoCache_data %>%
distinct(Model_num, .keep_all = TRUE)
NLME_NoCache_data_filtered <- NLME_NoCache_data
# only data in common to all, (62 models for NONMEM)
NMIDs <- NONMEM_data_filtered %>%
select(Model_num)
NLMEIDs <- NLME_ADPO_data_filtered %>%
select(Model_num)
all_ids <- inner_join(NMIDs, NLMEIDs)
NONMEM_data_filtered <- NONMEM_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_standard_data_filtered <- NLME_standard_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_NoHessian_data_filtered <- NLME_NoHessian_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_NoCache_data_filtered <- NLME_NoCache_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_ADPO_data_filtered <- NLME_ADPO_data %>%
filter(Model_num %in% all_ids$Model_num )
plot_data <- rbind(NONMEM_data_filtered,NLME_standard_data_filtered,
NLME_ADPO_data_filtered,NLME_NoHessian_data,
NLME_NoCache_data)
plot_data <- plot_data %>% select(Model_num,n_theta,n_omega,Algorithm,
Est_time,Cov_time)
plot_data <- plot_data %>%
filter(Model_num %in% all_ids$Model_num)
# one additional THETA for NONMEM, for residual error
plot_data <- plot_data %>%
mutate(n_theta = if_else(Algorithm == "NONMEM",n_theta + 1, n_theta))
colnames(plot_data) <- c("Model_num","Number of Thetas","Number of  Omegas","Algorithm","Estimation","Covariance" )
library(reshape)
# need to collapse in to just Time, nparms for Est_time/Cov_time and n_theta, neta
new_a <- melt(plot_data, variable_name = c("Parameter"),id = c("Model_num","Algorithm"),
measure.vars = c("Estimation","Covariance"))
new_b <- melt(plot_data, variable_name = c("n_parms"),id = c("Model_num","Algorithm"),
measure.vars = c("Number of Thetas","Number of  Omegas"))
new_data <- inner_join(new_a,new_b,by=c("Model_num","Algorithm"),relationship = "many-to-many")
colnames(new_data) <- c("Model_num" ,"Algorithm" ,"Parameter", "Time","which_parm","n_parms")
new_data <- new_data %>%
mutate(Time = Time/60)
# remove crashes
new_data <-  new_data %>%
filter(Time > 0)
library(scales)
TimeNTheta <- ggplot(new_data %>% filter(which_parm == 'Number of Thetas')) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="none")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNTheta
ggsave("TimeTheta.jpeg",
plot= TimeNTheta,
device="jpeg",
width=3.3,
height=4)
TimeNOmega <- ggplot(new_data %>% filter(which_parm == 'Number of  Omegas')) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position=c(0.74,.61),
legend.key.size = unit(0.35, 'cm'), #change legend key size
legend.key.height = unit(0.24, 'cm'), #change legend key height
legend.key.width = unit(0.24, 'cm'), #change legend key width
legend.title = element_text(size=4), #change legend title font size
legend.text = element_text(size=4))+ #change legend text font size
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega
ggsave("TimeOmega.jpeg",
plot= TimeNOmega,
device="jpeg",
width=3.3,
height=4)
rm(list=ls())
## path to python.exe can be found with where python.exe command from DOS command line
WindowspyDarwinInterpreter <- "C:/Python/Python311/python.exe"
Windowsnmfe_path <- "C:/nm74g64/util/nmfe74.bat"
#WindowsINSTALLDIRADPO <- "D:/NLME_Engine_ADPO"
#WindowsINSTALLDIRADPO <- "D:/NLME-Engine-24.9.1-build.444"
WindowsINSTALLDIRADPO <- "D:/nlme_459"
WindowsINSTALLDIRnoHessian <- "D:/NLME_Engine_noHessian"
WindowsINSTALLDIRnoCache <- "D:/NLME_Engine_noCache"
Linuxnlme_dir <- "/home/user/InstallDirNLME/"
home_dir <- getwd()
# used by NLME
if (Sys.info()['sysname'] == "Linux") {
pyDarwinInterpreter <- "/home/user/venv/bin/python3"
nmfe_path <- "/opt/nm751/util/nmfe75"
gcc_dir <- dirname(system("which gcc", intern = TRUE))
# nlme_dir <- "/home/user/InstallDirNLME/"
if (grepl("Ubuntu", Sys.info()["version"])) {
Sys.setenv("PML_BIN_DIR" = "UBUNTU2204")
}
INSTALLDIRStandard <- Linuxnlme_dir
INSTALLDIRADPO <- "home/user/NLME_Engine_ADPO"
INSTALLDIRnoHessian <- "home/user/NLME_Engine_noHessian"
} else {
pyDarwinInterpreter <- WindowspyDarwinInterpreter
nmfe_path <- Windowsnmfe_path
# for Windows NLME engine
gcc_dir <- "C:\\Program Files\\Certara\\mingw64"
nlme_dir <- "C:\\Program Files\\Certara\\NLME_Engine"
INSTALLDIRStandard <- nlme_dir
INSTALLDIRADPO <- WindowsINSTALLDIRADPO
INSTALLDIRnoHessian <- WindowsINSTALLDIRnoHessian
INSTALLDIRnoCache <- WindowsINSTALLDIRnoCache
}
nlme_dirs <- c(standard = INSTALLDIRStandard,
ADPO = INSTALLDIRADPO,
NoHessian = INSTALLDIRnoHessian,
noCache = INSTALLDIRnoCache)
library(R.utils)
library(Metrics)
library(readr)
library(stringr)
library(dplyr)
library(data.table)
library(lubridate)
library(readtext)
library(Certara.RsNLME)
library(Certara.RDarwin)
library(xml2)
library(ggplot2)
source(file.path(home_dir,"make_data.R"))
source(file.path(home_dir,"check_data.R"))
source(file.path(home_dir,"ReadNM_xml.R"))
source(file.path(home_dir,"CompileResultsNONMEM.R"))
source(file.path(home_dir,"CleanUp.R"))
source(file.path(home_dir,"CompileResultsNLME.R"))
source(file.path(home_dir,"GetTrueParms.R"))
#make_data(home_dir, pyDarwinInterpreter, nmfe_path, nlme_dir, gcc_dir)
# make NONMEM control files
message("Veryfying data sets")
for(i in 1:72){
check_data(home_dir,i)
}
# don't have status in nonmem yet, need to rerun, just calculate for now
NONMEM_data <- read.csv("NONMEMresults.csv")
# calculate status 7 if crash/didn't complete, 1 is success, 4 if errors
NONMEM_data <- NONMEM_data %>%
mutate(Status = if_else(messages == 37,1,4))  %>%
mutate(Status = if_else(messages == -99999,7,Status))  %>%
relocate(Status, .after = Success)
NONMEM_data_filtered <- NONMEM_data %>%
filter(Status < 7)
NLME_standard_data <- read.csv("NLMEResults_Standard.csv")
# fix algorithm name
NLME_standard_data$Algorithm <- "Standard"
NLME_standard_data_filtered <- NLME_standard_data
NLME_ADPO_data <- read.csv("NLMEResults_ADPO.csv")
# only adpo data at this point has status, for plots filter out status == 7
NLME_ADPO_data_filtered <- NLME_ADPO_data %>%
dplyr::filter(Status < 5)
NLME_NoHessian_data <- read.csv("NLMEResults_NoHessian.csv")
NLME_NoHessian_data_filtered <- NLME_NoHessian_data # none crashed
NLME_NoCache_data <- read.csv("NLMEResults_NoCache.csv")
# fix name
NLME_NoCache_data$Algorithm <- "NoCache"
# need to rereun no cache to get status
NLME_NoCache_data <- NLME_NoCache_data %>%
mutate(Status = messages)  %>%
relocate(Status, .after = Success)
NLME_NoCache_data <- NLME_NoCache_data %>%
distinct(Model_num, .keep_all = TRUE)
NLME_NoCache_data_filtered <- NLME_NoCache_data
# only data in common to all, (62 models for NONMEM)
NMIDs <- NONMEM_data_filtered %>%
select(Model_num)
NLMEIDs <- NLME_ADPO_data_filtered %>%
select(Model_num)
all_ids <- inner_join(NMIDs, NLMEIDs)
NONMEM_data_filtered <- NONMEM_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_standard_data_filtered <- NLME_standard_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_NoHessian_data_filtered <- NLME_NoHessian_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_NoCache_data_filtered <- NLME_NoCache_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_ADPO_data_filtered <- NLME_ADPO_data %>%
filter(Model_num %in% all_ids$Model_num )
plot_data <- rbind(NONMEM_data_filtered,NLME_standard_data_filtered,
NLME_ADPO_data_filtered,NLME_NoHessian_data,
NLME_NoCache_data)
plot_data <- plot_data %>% select(Model_num,n_theta,n_omega,Algorithm,
Est_time,Cov_time)
plot_data <- plot_data %>%
filter(Model_num %in% all_ids$Model_num)
# one additional THETA for NONMEM, for residual error
plot_data <- plot_data %>%
mutate(n_theta = if_else(Algorithm == "NONMEM",n_theta + 1, n_theta))
colnames(plot_data) <- c("Model_num","Number of Thetas","Number of  Omegas","Algorithm","Estimation","Covariance" )
library(reshape)
# need to collapse in to just Time, nparms for Est_time/Cov_time and n_theta, neta
new_a <- melt(plot_data, variable_name = c("Parameter"),id = c("Model_num","Algorithm"),
measure.vars = c("Estimation","Covariance"))
new_b <- melt(plot_data, variable_name = c("n_parms"),id = c("Model_num","Algorithm"),
measure.vars = c("Number of Thetas","Number of  Omegas"))
new_data <- inner_join(new_a,new_b,by=c("Model_num","Algorithm"),relationship = "many-to-many")
colnames(new_data) <- c("Model_num" ,"Algorithm" ,"Parameter", "Time","which_parm","n_parms")
new_data <- new_data %>%
mutate(Time = Time/60)
# remove crashes
new_data <-  new_data %>%
filter(Time > 0)
library(scales)
# remove crashes
new_data <-  new_data %>%
filter(Time > 0)
TimeNTheta <- ggplot(new_data %>% filter(which_parm == 'Number of Thetas')) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="none")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNTheta
ggsave("TimeTheta.jpeg",
plot= TimeNTheta,
device="jpeg",
width=3.3,
height=4)
TimeNOmega <- ggplot(new_data %>% filter(which_parm == 'Number of  Omegas')) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position=c(0.74,.61),
legend.key.size = unit(0.35, 'cm'), #change legend key size
legend.key.height = unit(0.24, 'cm'), #change legend key height
legend.key.width = unit(0.24, 'cm'), #change legend key width
legend.title = element_text(size=4), #change legend title font size
legend.text = element_text(size=4))+ #change legend text font size
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega
TimeNOmega <- ggplot(new_data %>% filter(which_parm == 'Number of  Omegas')) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
theme(legend.position="bottom"))
TimeNOmega
TimeNOmega <- ggplot(new_data %>% filter(which_parm == 'Number of  Omegas')) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position=c(0.74,.61),
legend.key.size = unit(0.35, 'cm'), #change legend key size
legend.key.height = unit(0.24, 'cm'), #change legend key height
legend.key.width = unit(0.24, 'cm'), #change legend key width
legend.title = element_text(size=4), #change legend title font size
legend.text = element_text(size=4))+ #change legend text font size
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega + theme(legend.position="bottom")
?legend.position
TimeNOmega <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega + theme(legend.position="bottom")
TimeNOmega <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank()) +
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega + theme(legend.position="bottom")
TimeNOmega <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm) +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(), scales = "free"
) +
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega + theme(legend.position="bottom")
TimeNOmega <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8) +
facet_grid(Parameter~which_parm, scales = "free") +
ylab("Time (minutes)") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank()
) +
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNOmega + theme(legend.position="bottom")
TimeNnParm <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm, scales = "free") +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="bottom")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))+
theme(legend.position="bottom")
TimeNnParm <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm, scales = "free") +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="bottom")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNTheta
TimeNParm <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm, scales = "free") +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="bottom")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNParm
TimeNParm <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm, scales = "free") +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="bottom")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNParm
ggsave("TimeNParm.jpeg",
plot= TimeNParm,
device="jpeg",
width=3.3,
height=4)
ggsave("TimeNParm.jpeg",
plot= TimeNParm,
device="jpeg",
width=6.6,
height=4)
ggsave("TimeNParm.jpeg",
plot= TimeNParm,
device="jpeg",
width=6,
height=4)
######################## fraction converged
all_data <- rbind(NONMEM_data,
NLME_standard_data,
NLME_ADPO_data,
NLME_NoHessian_data,
NLME_NoCache_data)
# don't have status in nonmem yet, need to rerun, just calculate for now
NONMEM_data <- read.csv("NONMEMresults.csv")
# calculate status 7 if crash/didn't complete, 1 is success, 4 if errors
NONMEM_data <- NONMEM_data %>%
mutate(Status = if_else(messages == 37,1,4))  %>%
mutate(Status = if_else(messages == -99999,7,Status))  %>%
relocate(Status, .after = Success)
NONMEM_data_filtered <- NONMEM_data %>%
filter(Status < 7)
NLME_standard_data <- read.csv("NLMEResults_Standard.csv")
# fix algorithm name
NLME_standard_data$Algorithm <- "Standard"
NLME_standard_data_filtered <- NLME_standard_data
NLME_ADPO_data <- read.csv("NLMEResults_ADPO.csv")
NLME_ADPO_data$Algorithm <- "AD"
# only adpo data at this point has status, for plots filter out status == 7
NLME_ADPO_data_filtered <- NLME_ADPO_data %>%
dplyr::filter(Status < 5)
NLME_NoHessian_data <- read.csv("NLMEResults_NoHessian.csv")
NLME_NoHessian_data_filtered <- NLME_NoHessian_data # none crashed
NLME_NoCache_data <- read.csv("NLMEResults_NoCache.csv")
# fix name
NLME_NoCache_data$Algorithm <- "NoCache"
# need to rereun no cache to get status
NLME_NoCache_data <- NLME_NoCache_data %>%
mutate(Status = messages)  %>%
relocate(Status, .after = Success)
NLME_NoCache_data <- NLME_NoCache_data %>%
distinct(Model_num, .keep_all = TRUE)
NLME_NoCache_data_filtered <- NLME_NoCache_data
# only data in common to all, (62 models for NONMEM)
NMIDs <- NONMEM_data_filtered %>%
select(Model_num)
NLMEIDs <- NLME_ADPO_data_filtered %>%
select(Model_num)
all_ids <- inner_join(NMIDs, NLMEIDs)
NONMEM_data_filtered <- NONMEM_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_standard_data_filtered <- NLME_standard_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_NoHessian_data_filtered <- NLME_NoHessian_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_NoCache_data_filtered <- NLME_NoCache_data %>%
filter(Model_num %in% all_ids$Model_num )
NLME_ADPO_data_filtered <- NLME_ADPO_data %>%
filter(Model_num %in% all_ids$Model_num )
plot_data <- rbind(NONMEM_data_filtered,NLME_standard_data_filtered,
NLME_ADPO_data_filtered,NLME_NoHessian_data,
NLME_NoCache_data)
plot_data <- plot_data %>% select(Model_num,n_theta,n_omega,Algorithm,
Est_time,Cov_time)
plot_data <- plot_data %>%
filter(Model_num %in% all_ids$Model_num)
# one additional THETA for NONMEM, for residual error
plot_data <- plot_data %>%
mutate(n_theta = if_else(Algorithm == "NONMEM",n_theta + 1, n_theta))
colnames(plot_data) <- c("Model_num","Number of Thetas","Number of  Omegas","Algorithm","Estimation","Covariance" )
library(reshape)
# need to collapse in to just Time, nparms for Est_time/Cov_time and n_theta, neta
new_a <- melt(plot_data, variable_name = c("Parameter"),id = c("Model_num","Algorithm"),
measure.vars = c("Estimation","Covariance"))
new_b <- melt(plot_data, variable_name = c("n_parms"),id = c("Model_num","Algorithm"),
measure.vars = c("Number of Thetas","Number of  Omegas"))
new_data <- inner_join(new_a,new_b,by=c("Model_num","Algorithm"),relationship = "many-to-many")
colnames(new_data) <- c("Model_num" ,"Algorithm" ,"Parameter", "Time","which_parm","n_parms")
new_data <- new_data %>%
mutate(Time = Time/60)
# remove crashes
new_data <-  new_data %>%
filter(Time > 0)
TimeNParm <- ggplot(new_data) +
geom_point(aes(x=n_parms, y = Time,colour = Algorithm, fill=Algorithm, shape=Algorithm), size = 1.2) +
geom_smooth(aes(n_parms,Time,col=Algorithm),method="lm",se=FALSE, linewidth=0.8)+
facet_grid(Parameter~which_parm, scales = "free") +
ylab("Time (minutes)") +
xlab("Number of  Thetas") +
theme(strip.text = element_text(size = 10),
axis.title.x= element_blank(),
legend.position="bottom")+
scale_y_log10(breaks = c(0.01, 0.1, 1,10,100),labels = c(0.01, 0.1, 1,10,100))
TimeNParm
ggsave("TimeNParm.jpeg",
plot= TimeNParm,
device="jpeg",
width=6,
height=4)
######################## fraction converged
all_data <- rbind(NONMEM_data,
NLME_standard_data,
NLME_ADPO_data,
NLME_NoHessian_data,
NLME_NoCache_data)
table_data <- all_data %>%
dplyr::select(n_theta, n_omega, Success,Covar,Algorithm) %>%
group_by(Algorithm) %>%
summarise(Converge = 100*mean(Success),Covar= 100*mean(Covar))
print(table_data)
write.csv(table_data,"Table.csv")
